version: "3.3"

services:

  flask:
    build: ../
    command: "gunicorn -w 2 main:app --bind 0.0.0.0:${FLASK_INTERNAL_PORT}"
    expose:
      - "${FLASK_INTERNAL_PORT}"
    restart: on-failure
    volumes:
      - ./.env:/app/src/.env
    env_file:
      - .env

  tests:
    build: .
    working_dir: /app
    environment:
      - PYTHONPATH=/app
    entrypoint: >
      sh -c "pytest /app/functional/src"